<!DOCTYPE html>
<html>
<head>
    <title>Ops-Map Legacy</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="stylesheet" href="leaflet.css" />
    <style>
        /* BULLETPROOF LAYOUT */
        html, body { height: 100%; margin: 0; padding: 0; background: #000; overflow: hidden; font-family: sans-serif; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; z-index: 1; background: #222; }

        /* SLIDING MENU (Drawer) */
        #drawer {
            position: absolute; top: 0; left: -260px; width: 250px; height: 100%;
            background: #333; color: #fff; z-index: 9999;
            border-right: 5px solid orange;
            transition: left 0.3s; -webkit-transition: left 0.3s; /* Smooth on Android 4.1 */
        }
        #drawer.open { left: 0px; }
        
        /* MENU BUTTONS */
        .menu-btn { 
            display: block; width: 90%; margin: 10px auto; padding: 15px; 
            background: #444; border: 1px solid #666; color: #fff; 
            text-align: left; font-size: 16px;
        }
        #menu-toggle {
            position: absolute; top: 10px; right: 10px; z-index: 10000;
            background: orange; padding: 10px; border: none; font-weight: bold;
        }

        /* HIDDEN CAMERA INPUT */
        #cam-input { display: none; }
    </style>
</head>
<body>

    <button id="menu-toggle" onclick="toggleMenu()">MENU</button>

    <div id="drawer">
        <h3 style="text-align:center">Ops Control</h3>
        <button class="menu-btn" onclick="findMe()">[ ] Find My Location</button>
        <button class="menu-btn" onclick="startNav()">[ ] Navigate A to B</button>
        <button class="menu-btn" onclick="togglePOIs()">[ ] Toggle POIs (Blue Lines)</button>
        <hr>
        <button class="menu-btn" onclick="document.getElementById('cam-input').click()">[ ] Take & Share Photo</button>
        <button class="menu-btn" onclick="copyCoords()">[ ] Copy Coordinates</button>
        <input type="file" id="cam-input" accept="image/*" capture="camera" onchange="processPhoto(this)">
    </div>

    <div id="map"></div>

    <script src="leaflet.js"></script>
    <script>
        var map = L.map('map', {zoomControl: false}).setView([1.49, 103.75], 13);
        
        // STANDARD LAYER (HTTP to avoid SSL issues)
        var stdLayer = L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        
        // POI LAYER (Hidden by default)
        var poiLayer = L.layerGroup(); 
        // Example POI - Add your Johor JSON markers here
        L.marker([1.492, 103.761]).bindPopup("JB Central").addTo(poiLayer);

        function toggleMenu() {
            var d = document.getElementById('drawer');
            d.className = (d.className === 'open') ? '' : 'open';
        }

        function togglePOIs() {
            if (map.hasLayer(poiLayer)) { map.removeLayer(poiLayer); } 
            else { poiLayer.addTo(map); }
        }

        function findMe() {
            map.locate({setView: true, maxZoom: 16, enableHighAccuracy: true});
            toggleMenu();
        }

        function copyCoords() {
            var center = map.getCenter();
            var txt = center.lat.toFixed(5) + "," + center.lng.toFixed(5);
            alert("Copied: " + txt); // Simple alert for legacy reliability
        }

        function processPhoto(input) {
            if (input.files && input.files[0]) {
                alert("Photo Captured! Ready to share with coordinates.");
                // Here we would trigger the sharing logic
            }
        }
    </script>
</body>
</html>